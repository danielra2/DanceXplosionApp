var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function n(e,t,r,n){return new(r||(r=Promise))(function(o,a){function i(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(i,s)}c((n=n.apply(e,t||[])).next())})}function o(e,t){var r,n,o,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},i=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return i.next=s(0),i.throw=s(1),i.return=s(2),"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}function a(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}function i(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;const s=(e,t)=>t.some(t=>e instanceof t);let c,u;const l=new WeakMap,f=new WeakMap,p=new WeakMap;let h={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return m(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function v(e){h=e(h)}function d(e){return(u||(u=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(g(this),t),m(this.request)}:function(...t){return m(e.apply(g(this),t))}}function y(e){return"function"==typeof e?d(e):(e instanceof IDBTransaction&&function(e){if(l.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",a),e.removeEventListener("abort",a)},o=()=>{t(),n()},a=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",o),e.addEventListener("error",a),e.addEventListener("abort",a)});l.set(e,t)}(e),s(e,c||(c=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,h):e)}function m(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",o),e.removeEventListener("error",a)},o=()=>{t(m(e.result)),n()},a=()=>{r(e.error),n()};e.addEventListener("success",o),e.addEventListener("error",a)});return p.set(t,e),t}(e);if(f.has(e))return f.get(e);const t=y(e);return t!==e&&(f.set(e,t),p.set(t,e)),t}const g=e=>p.get(e);function b(e,t,{blocked:r,upgrade:n,blocking:o,terminated:a}={}){const i=indexedDB.open(e,t),s=m(i);return n&&i.addEventListener("upgradeneeded",e=>{n(m(i.result),e.oldVersion,e.newVersion,m(i.transaction),e)}),r&&i.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),s.then(e=>{a&&e.addEventListener("close",()=>a()),o&&e.addEventListener("versionchange",e=>o(e.oldVersion,e.newVersion,e))}).catch(()=>{}),s}const w=["get","getKey","getAll","getAllKeys","count"],S=["put","add","delete","clear"],x=new Map;function I(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(x.get(t))return x.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,o=S.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!o&&!w.includes(r))return;const a=async function(e,...t){const a=this.transaction(e,o?"readwrite":"readonly");let i=a.store;return n&&(i=i.index(t.shift())),(await Promise.all([i[r](...t),o&&a.done]))[0]};return x.set(t,a),a}v(e=>({...e,get:(t,r,n)=>I(t,r)||e.get(t,r,n),has:(t,r)=>!!I(t,r)||e.has(t,r)}));const E=["continue","continuePrimaryKey","advance"],C={},O=new WeakMap,T=new WeakMap,j={get(e,t){if(!E.includes(t))return e[t];let r=C[t];return r||(r=C[t]=function(...e){O.set(this,T.get(this)[t](...e))}),r}};async function*A(...e){let t=this;if(t instanceof IDBCursor||(t=await t.openCursor(...e)),!t)return;const r=new Proxy(t,j);for(T.set(r,t),p.set(r,g(t));t;)yield r,t=await(O.get(r)||t.continue()),O.delete(r)}function D(e,t){return t===Symbol.asyncIterator&&s(e,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===t&&s(e,[IDBIndex,IDBObjectStore])}v(e=>({...e,get:(t,r,n)=>D(t,r)?A:e.get(t,r,n),has:(t,r)=>D(t,r)||e.has(t,r)}));var B=function(e,t){return B=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},B(e,t)};var _=function(){return _=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},_.apply(this,arguments)};function k(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}"function"==typeof SuppressedError&&SuppressedError;var P="is",L="is not",M="contains",N="does not contain",R="less",F="less or equal",q="greater",K="greater or equal",U="version less",V="version less or equal",W="version greater",z="version greater or equal",H="set is",J="set is not",G="set contains",$="set does not contain",Q="set contains any",X="set does not contain any",Y="regex match",Z="regex does not match",ee=-862048943,te=461845907,re=function(e,t){void 0===t&&(t=0);for(var r=function(e){for(var t=[],r=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);o<128?t[r++]=o:o<2048?(t[r++]=o>>6|192,t[r++]=63&o|128):55296==(64512&o)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++n)),t[r++]=o>>18|240,t[r++]=o>>12&63|128,t[r++]=o>>6&63|128,t[r++]=63&o|128):(t[r++]=o>>12|224,t[r++]=o>>6&63|128,t[r++]=63&o|128)}return Uint8Array.from(t)}(e),n=r.length,o=n>>2,a=t,i=0;i<o;i++){var s=ie(r,i<<2);a=ne(s,a)}var c=o<<2,u=0;switch(n-c){case 3:u^=r[c+2]<<16,u^=r[c+1]<<8,u^=r[c],u=Math.imul(u,ee),u=ae(u,15),a^=u=Math.imul(u,te);break;case 2:u^=r[c+1]<<8,u^=r[c],u=Math.imul(u,ee),u=ae(u,15),a^=u=Math.imul(u,te);break;case 1:u^=r[c],u=Math.imul(u,ee),u=ae(u,15),a^=u=Math.imul(u,te)}return oe(a^=n)>>>0},ne=function(e,t){var r=e,n=t;return r=Math.imul(r,ee),r=ae(r,15),r=Math.imul(r,te),n=ae(n^=r,13),(n=Math.imul(n,5))+-430675100|0},oe=function(e){var t=e;return t^=t>>>16,t=Math.imul(t,-2048144789),t^=t>>>13,t=Math.imul(t,-1028477387),t^=t>>>16},ae=function(e,t,r){return void 0===r&&(r=32),t>r&&(t%=r),(e<<t|(e&4294967295<<r-t>>>0)>>>0>>>r-t>>>0)>>>0},ie=function(e,t){void 0===t&&(t=0);var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return se(r)},se=function(e){return(-16777216&e)>>>24|(16711680&e)>>>8|(65280&e)<<8|(255&e)<<24},ce=function(e,t){var r,n;if(t&&0!==t.length){try{for(var o=k(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(!i||!e||"object"!=typeof e)return;e=e[i]}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return e||void 0}},ue="^".concat("(\\d+)\\.(\\d+)","(\\.").concat("(\\d+)").concat("(-(([-\\w]+\\.?)*))?",")?$"),le=function(){function e(e,t,r,n){void 0===n&&(n=void 0),this.major=e,this.minor=t,this.patch=r,this.preRelease=n}return e.parse=function(t){if(t){var r=new RegExp(ue).exec(t);if(r){var n=Number(r[1]),o=Number(r[2]);if(!isNaN(n)&&!isNaN(o))return new e(n,o,Number(r[4])||0,r[5]||void 0)}}},e.prototype.compareTo=function(e){return this.major>e.major?1:this.major<e.major?-1:this.minor>e.minor?1:this.minor<e.minor?-1:this.patch>e.patch?1:this.patch<e.patch||this.preRelease&&!e.preRelease?-1:!this.preRelease&&e.preRelease?1:this.preRelease&&e.preRelease?this.preRelease>e.preRelease?1:this.preRelease<e.preRelease?-1:0:0},e}(),fe=function(){function e(){}return e.prototype.evaluate=function(e,t){var r,n,o={},a={context:e,result:o};try{for(var i=k(t),s=i.next();!s.done;s=i.next()){var c=s.value,u=this.evaluateFlag(a,c);u&&(o[c.key]=u)}}catch(e){r={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return o},e.prototype.evaluateFlag=function(e,t){var r,n,o;try{for(var a=k(t.segments),i=a.next();!i.done;i=a.next()){var s=i.value;if(o=this.evaluateSegment(e,t,s)){var c=_(_(_({},t.metadata),s.metadata),o.metadata);o=_(_({},o),{metadata:c});break}}}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o},e.prototype.evaluateSegment=function(e,t,r){var n,o,a,i;if(!r.conditions)return void 0!==(u=this.bucket(e,r))?t.variants[u]:void 0;try{for(var s=k(r.conditions),c=s.next();!c.done;c=s.next()){var u,l=c.value,f=!0;try{for(var p=(a=void 0,k(l)),h=p.next();!h.done;h=p.next()){var v=h.value;if(!(f=this.matchCondition(e,v)))break}}catch(e){a={error:e}}finally{try{h&&!h.done&&(i=p.return)&&i.call(p)}finally{if(a)throw a.error}}if(f)return void 0!==(u=this.bucket(e,r))?t.variants[u]:void 0}}catch(e){n={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(n)throw n.error}}},e.prototype.matchCondition=function(e,t){var r=ce(e,t.selector);if(r){if(this.isSetOperator(t.op)){var n=this.coerceStringArray(r);return!!n&&this.matchSet(n,t.op,t.values)}var o=this.coerceString(r);return void 0!==o&&this.matchString(o,t.op,t.values)}return this.matchNull(t.op,t.values)},e.prototype.getHash=function(e){return re(e)},e.prototype.bucket=function(e,t){var r,n,o,a;if(!t.bucket)return t.variant;var i=this.coerceString(ce(e,t.bucket.selector));if(!i||0===i.length)return t.variant;var s="".concat(t.bucket.salt,"/").concat(i),c=this.getHash(s),u=c%100,l=Math.floor(c/100);try{for(var f=k(t.bucket.allocations),p=f.next();!p.done;p=f.next()){var h=p.value,v=h.range[0],d=h.range[1];if(u>=v&&u<d)try{for(var y=(o=void 0,k(h.distributions)),m=y.next();!m.done;m=y.next()){var g=m.value,b=g.range[0],w=g.range[1];if(l>=b&&l<w)return g.variant}}catch(e){o={error:e}}finally{try{m&&!m.done&&(a=y.return)&&a.call(y)}finally{if(o)throw o.error}}}}catch(e){r={error:e}}finally{try{p&&!p.done&&(n=f.return)&&n.call(f)}finally{if(r)throw r.error}}return t.variant},e.prototype.matchNull=function(e,t){var r=this.containsNone(t);switch(e){case P:case M:case R:case F:case q:case K:case U:case V:case W:case z:case H:case G:case Q:return r;case L:case N:case $:case X:return!r;default:return!1}},e.prototype.matchSet=function(e,t,r){switch(t){case H:return this.setEquals(e,r);case J:return!this.setEquals(e,r);case G:return this.matchesSetContainsAll(e,r);case $:return!this.matchesSetContainsAll(e,r);case Q:return this.matchesSetContainsAny(e,r);case X:return!this.matchesSetContainsAny(e,r);default:return!1}},e.prototype.matchString=function(e,t,r){var n=this;switch(t){case P:return this.matchesIs(e,r);case L:return!this.matchesIs(e,r);case M:return this.matchesContains(e,r);case N:return!this.matchesContains(e,r);case R:case F:case q:case K:return this.matchesComparable(e,t,r,function(e){return n.parseNumber(e)},this.comparator);case U:case V:case W:case z:return this.matchesComparable(e,t,r,function(e){return le.parse(e)},this.versionComparator);case Y:return this.matchesRegex(e,r);case Z:return!this.matchesRegex(e,r);default:return!1}},e.prototype.matchesIs=function(e,t){if(this.containsBooleans(t)){var r=e.toLowerCase();if("true"===r||"false"===r)return t.some(function(e){return e.toLowerCase()===r})}return t.some(function(t){return e===t})},e.prototype.matchesContains=function(e,t){var r,n;try{for(var o=k(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(e.toLowerCase().includes(i.toLowerCase()))return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e.prototype.matchesComparable=function(e,t,r,n,o){var a=this,i=n(e),s=r.map(function(e){return n(e)}).filter(function(e){return void 0!==e});return void 0===i||0===s.length?r.some(function(r){return a.comparator(e,t,r)}):s.some(function(e){return o(i,t,e)})},e.prototype.comparator=function(e,t,r){switch(t){case R:case U:return e<r;case F:case V:return e<=r;case q:case W:return e>r;case K:case z:return e>=r;default:return!1}},e.prototype.versionComparator=function(e,t,r){var n=e.compareTo(r);switch(t){case R:case U:return n<0;case F:case V:return n<=0;case q:case W:return n>0;case K:case z:return n>=0;default:return!1}},e.prototype.matchesRegex=function(e,t){return t.some(function(t){return Boolean(new RegExp(t).exec(e))})},e.prototype.containsNone=function(e){return e.some(function(e){return"(none)"===e})},e.prototype.containsBooleans=function(e){return e.some(function(e){switch(e.toLowerCase()){case"true":case"false":return!0;default:return!1}})},e.prototype.parseNumber=function(e){var t;return null!==(t=Number(e))&&void 0!==t?t:void 0},e.prototype.coerceString=function(e){if(e)return"object"==typeof e?JSON.stringify(e):String(e)},e.prototype.coerceStringArray=function(e){var t=this;if(Array.isArray(e))return e.map(function(e){return t.coerceString(e)}).filter(Boolean);var r=String(e);try{var n=JSON.parse(r);return Array.isArray(n)?e.map(function(e){return t.coerceString(e)}).filter(Boolean):void 0}catch(e){return}},e.prototype.isSetOperator=function(e){switch(e){case H:case J:case G:case $:case Q:case X:return!0;default:return!1}},e.prototype.setEquals=function(e,t){var r=new Set(e),n=new Set(t);return r.size===n.size&&function(e,t,r){if(r||2===arguments.length)for(var n,o=0,a=t.length;o<a;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))}([],function(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,a=r.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(n=a.next()).done;)i.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=a.return)&&r.call(a)}finally{if(o)throw o.error}}return i}(n),!1).every(function(e){return r.has(e)})},e.prototype.matchesSetContainsAll=function(e,t){var r,n;if(e.length<t.length)return!1;try{for(var o=k(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(!this.matchesIs(i,e))return!1}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!0},e.prototype.matchesSetContainsAny=function(e,t){var r,n;try{for(var o=k(t),a=o.next();!a.done;a=o.next()){var i=a.value;if(this.matchesIs(i,e))return!0}}catch(e){r={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return!1},e}();"function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder&&new TextEncoder;const pe=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=");(()=>{let e={};pe.forEach((t,r)=>e[t]=r)})(),String.fromCharCode.bind(String),"function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),function(e){function t(r,n){var o=e.call(this,n)||this;return o.statusCode=r,Object.setPrototypeOf(o,t.prototype),o}(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}B(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)})(t,e)}(Error);var he=new function(){var e=this;this.dbs={},this.createStore=function(t){return n(e,void 0,void 0,function(){return o(this,function(e){switch(e.label){case 0:return[4,b(t,1,{upgrade:function(e){e.objectStoreNames.contains("eventTypesForSession")||e.createObjectStore("eventTypesForSession",{keyPath:"sessionId"})}})];case 1:return[2,e.sent()]}})})},this.openOrCreateDB=function(t){return n(e,void 0,void 0,function(){var e,r;return o(this,function(n){switch(n.label){case 0:return this.dbs&&this.dbs[t]?[2,this.dbs[t]]:(e="".concat(t.substring(0,10),"_amp_targeting"),[4,this.createStore(e)]);case 1:return r=n.sent(),this.dbs[t]=r,[2,r]}})})},this.updateEventListForSession=function(t){var a=t.sessionId,i=t.eventType,s=t.eventTime,c=t.loggerProvider,u=t.tx;return n(e,void 0,void 0,function(){var e,t,n,l,f,p,h,v,d;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),e=String(a),[4,u.store.get(e)];case 1:return t=o.sent(),n=t?t.eventTypes:{},l=n[i]||{},f=r(r({},n),((v={})[i]=r(r({},l),((d={})[s]={event_type:i},d)),v)),p={sessionId:e,eventTypes:f,lastUpdated:Date.now()},[4,u.store.put(p)];case 2:return o.sent(),[2,f];case 3:return h=o.sent(),c.warn("Failed to store events for targeting ".concat(a,": ").concat(h)),[3,4];case 4:return[2,void 0]}})})},this.deleteOldSessionEventTypes=function(t){var r=t.currentSessionId,a=t.loggerProvider,i=t.tx;return n(e,void 0,void 0,function(){var e,t,n,s,c,u;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,6,,7]),e=String(r),[4,i.store.getAll()];case 1:t=o.sent(),n=0,o.label=2;case 2:return n<t.length?(s=t[n],c=Date.now()-s.lastUpdated,s.sessionId!==e&&c>1728e5?[4,i.store.delete(s.sessionId)]:[3,4]):[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[3,7];case 6:return u=o.sent(),a.warn("Failed to clear old session event types for targeting: ".concat(u)),[3,7];case 7:return[2]}})})},this.storeEventTypeForSession=function(t){var r=t.loggerProvider,a=t.sessionId,i=t.eventType,s=t.eventTime,c=t.apiKey;return n(e,void 0,void 0,function(){var e,t,n,u;return o(this,function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),[4,this.openOrCreateDB(c)];case 1:return e=o.sent(),(t=e.transaction("eventTypesForSession","readwrite"))?[4,this.updateEventListForSession({sessionId:a,tx:t,loggerProvider:r,eventType:i,eventTime:s})]:[2];case 2:return n=o.sent(),[4,this.deleteOldSessionEventTypes({currentSessionId:a,tx:t,loggerProvider:r})];case 3:return o.sent(),[4,t.done];case 4:return o.sent(),[2,n];case 5:return u=o.sent(),r.warn("Failed to store events for targeting ".concat(a,": ").concat(u)),[3,6];case 6:return[2,void 0]}})})}},ve=function(){var e=this;this.evaluateTargeting=function(t){var r=t.apiKey,a=t.loggerProvider,i=t.event,s=t.sessionId,c=t.userProperties,u=t.deviceId,l=t.flag;return n(e,void 0,void 0,function(){var e,t,n,f;return o(this,function(o){switch(o.label){case 0:return i&&i.time?[4,he.storeEventTypeForSession({loggerProvider:a,apiKey:r,sessionId:s,eventType:i.event_type,eventTime:i.time})]:[3,2];case 1:return t=o.sent(),[3,3];case 2:t=void 0,o.label=3;case 3:return n=(e=t)&&new Set(Object.keys(e)),f={session_id:s,event:i,event_types:n&&Array.from(n),user:{device_id:u,user_properties:c}},[2,this.evaluationEngine.evaluate(f,[l])]}})})},this.evaluationEngine=new fe},de=function(){var e=new ve;return{evaluateTargeting:e.evaluateTargeting.bind(e)}}().evaluateTargeting,ye=Object.freeze({__proto__:null,evaluateTargeting:de});export{i as _,a,t as b,n as c,o as d,r as e,ye as i,b as o};
//# sourceMappingURL=targeting-min.js.map
